<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FeedHunger.org - Global Food Marketplace</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.91.1/dist/index.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    function App() {
      const [listings, setListings] = React.useState([]);
      const [formData, setFormData] = React.useState({
        goods: '',
        price: '',
        contact: '',
        country: '',
        about: ''
      });
      const [expandedAbout, setExpandedAbout] = React.useState({});
      const [selectedCountry, setSelectedCountry] = React.useState('All');

      // Replace with your Firebase config
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "feedhunger-org.firebaseapp.com",
        projectId: "feedhunger-org",
        storageBucket: "feedhunger-org.appspot.com",
        messagingSenderId: "YOUR_SENDER_ID",
        appId: "YOUR_APP_ID"
      };
      const app = firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      // Load listings from Firebase
      React.useEffect(() => {
        db.collection("listings").onSnapshot((snapshot) => {
          const data = snapshot.docs.map((doc) => ({ id: doc.id, ...doc.data() }));
          setListings(data);
        });
      }, []);

      // Handle form input changes
      const handleChange = (e) => {
        setFormData({ ...formData, [e.target.name]: e.target.value });
      };

      // Submit form to Firebase
      const handleSubmit = (e) => {
        e.preventDefault();
        db.collection("listings").add(formData).then(() => {
          alert("Listing added successfully!");
          setFormData({ goods: '', price: '', contact: '', country: '', about: '' });
        }).catch((error) => {
          alert("Error adding listing: " + error.message);
        });
      };

      // Toggle expandable about
      const toggleAbout = (id) => {
        setExpandedAbout((prev) => ({ ...prev, [id]: !prev[id] }));
      };

      // Filter listings by selected country
      const filteredListings = selectedCountry === 'All' ? listings : listings.filter((listing) => listing.country === selectedCountry);

      const connectWallet = async () => {
        try {
          if (window.solana && window.solana.isPhantom) {
            await window.solana.connect();
            alert("Connected to Phantom wallet!");
          } else {
            alert("Please install Phantom wallet to use HungerCoin.");
          }
        } catch (err) {
          console.error("Wallet connection error:", err);
          alert("Failed to connect wallet.");
        }
      };

      // Full alphabetical list of 195 countries
      const countries = [
        "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan",
        "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bhutan", "Bolivia", "Bosnia and Herzegovina", 
        "Botswana", "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Burundi", "Cabo Verde", "Cambodia", "Cameroon", "Canada", "Central African Republic",
        "Chad", "Chile", "China", "Colombia", "Comoros", "Congo (Congo-Brazzaville)", "Costa Rica", "Côte d'Ivoire", "Croatia", "Cuba", "Cyprus",
        "Czechia (Czech Republic)", "Democratic Republic of the Congo", "Denmark", "Djibouti", "Dominica", "Dominican Republic", "Ecuador", "Egypt", 
        "El Salvador", "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini (fmr. Swaziland)", "Ethiopia", "Fiji", "Finland", "France", "Gabon", 
        "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana", "Haiti", "Holy See", "Honduras",
        "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", "Italy", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya",
        "Kiribati", "Kuwait", "Kyrgyzstan", "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", "Luxembourg", 
        "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", "Mauritius", "Mexico", "Micronesia", "Moldova", 
        "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar (formerly Burma)", "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", 
        "Nicaragua", "Niger", "Nigeria", "North Korea", "North Macedonia", "Norway", "Oman", "Pakistan", "Palau", "Palestine State", "Panama", "Papua New Guinea",
        "Paraguay", "Peru", "Philippines", "Poland", "Portugal", "Qatar", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines",
        "Samoa", "San Marino", "Sao Tome and Principe", "Saudi Arabia", "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands",
        "Somalia", "South Africa", "South Korea", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", "Syria", "Tajikistan", "Tanzania", "Thailand",
        "Timor-Leste", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey", "Turkmenistan", "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", 
        "United States of America", "Uruguay", "Uzbekistan", "Vanuatu", "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"
      ];

      return (
        <div className="min-h-screen bg-gray-100">
          <header className="bg-blue-600 text-white p-4">
            <h1 className="text-2xl font-bold">FeedHunger.org</h1>
            <p className="text-sm">Global Platform for Regional Food Trade</p>
            <button 
              onClick={connectWallet}
              className="mt-2 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"
            >
              Connect Wallet
            </button>
          </header>
          <main className="max-w-7xl mx-auto p-4">
            <section className="mb-8">
              <h2 className="text-xl font-semibold mb-4">List Your Goods for Sale</h2>
              <form onSubmit={handleSubmit} className="bg-white p-4 rounded shadow">
                <div className="mb-4">
                  <label className="block text-gray-700">Goods for Sale</label>
                  <input 
                    type="text" 
                    name="goods" 
                    value={formData.goods} 
                    onChange={handleChange} 
                    className="w-full p-2 border rounded" 
                    placeholder="e.g., Organic Potatoes"
                    required 
                  />
                </div>
                <div className="mb-4">
                  <label className="block text-gray-700">Price (in HungerCoin)</label>
                  <input 
                    type="number" 
                    name="price" 
                    value={formData.price} 
                    onChange={handleChange} 
                    className="w-full p-2 border rounded" 
                    placeholder="e.g., 80/kg"
                    required 
                  />
                </div>
                <div className="mb-4">
                  <label className="block text-gray-700">Contact Information</label>
                  <input 
                    type="text" 
                    name="contact" 
                    value={formData.contact} 
                    onChange={handleChange} 
                    className="w-full p-2 border rounded" 
                    placeholder="e.g., email or phone"
                    required 
                  />
                </div>
                <div className="mb-4">
                  <label className="block text-gray-700">Country (Regional)</label>
                  <select 
                    name="country" 
                    value={formData.country} 
                    onChange={handleChange} 
                    className="w-full p-2 border rounded"
                    required
                  >
                    <option value="">Select your country</option>
                    {countries.map((country) => (
                      <option key={country} value={country}>{country}</option>
                    ))}
                  </select>
                </div>
                <div className="mb-4">
                  <label className="block text-gray-700">About Your Production</label>
                  <textarea 
                    name="about" 
                    value={formData.about} 
                    onChange={handleChange} 
                    className="w-full p-2 border rounded" 
                    placeholder="Describe what and how you produce (e.g., 'Sustainable farming with no pesticides')"
                    required 
                  />
                </div>
                <button type="submit" className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                  Submit Listing
                </button>
              </form>
            </section>
            <section className="mb-8">
              <h2 className="text-xl font-semibold mb-4">Filter Listings by Country</h2>
              <select 
                value={selectedCountry} 
                onChange={(e) => setSelectedCountry(e.target.value)} 
                className="w-full p-2 border rounded mb-4"
              >
                <option value="All">All Countries</option>
                {countries.map((country) => (
                  <option key={country} value={country}>{country}</option>
                ))}
              </select>
              <h2 className="text-xl font-semibold mb-4">Global Listings</h2>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                {filteredListings.map((listing) => (
                  <div key={listing.id} className="bg-white p-4 rounded shadow">
                    <h3 className="font-medium">{listing.goods}</h3>
                    <p className="text-gray-600">Price: {listing.price} HungerCoin</p>
                    <p className="text-gray-600">Country: {listing.country}</p>
                    <p className="text-gray-600">Contact: {listing.contact}</p>
                    <button 
                      onClick={() => toggleAbout(listing.id)} 
                      className="mt-2 text-blue-500 underline"
                    >
                      {expandedAbout[listing.id] ? "Hide About" : "Show About Production"}
                    </button>
                    {expandedAbout[listing.id] && <p className="text-gray-700 mt-2">{listing.about}</p>}
                    <button className="mt-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                      Buy with HungerCoin
                    </button>
                  </div>
                ))}
              </div>
            </section>
            <section>
              <h2 className="text-xl font-semibold mb-4">Our Mission</h2>
              <p className="text-gray-700">
                FeedHunger.org connects producers from every country regionally, allowing civilians to set up their information and production details. We fund hunger relief and community farms through transparent blockchain transactions, reducing carbon emissions by sourcing locally. © 2025 FeedHunger.org ™
              </p>
            </section>
          </main>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
